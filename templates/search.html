{% extends "base.html" %}
{% block content %}
<div style="max-width: 1600px; margin: 0 auto;">
  <div class="fade-in" style="margin-bottom: var(--space-6);">
    <h1 style="font-size: var(--text-4xl); font-weight: var(--font-bold); background: linear-gradient(135deg, var(--primary-600), var(--info-600)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; display: flex; align-items: center; gap: var(--space-3); margin-bottom: var(--space-2);">
      <svg style="width: 36px; height: 36px; color: var(--primary-600);" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
      </svg>
      Tìm kiếm nâng cao
    </h1>
    <p style="font-size: var(--text-base); color: var(--text-secondary);">
      <svg style="width: 18px; height: 18px; display: inline-block; vertical-align: middle; margin-right: var(--space-2);" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
      </svg>
      Tìm kiếm hợp đồng, phụ lục, tác phẩm và người dùng. User chỉ thấy dữ liệu của chính mình.
    </p>
  </div>

  <div class="card card-enhanced">
    <div class="card-header" style="background: linear-gradient(135deg, #FFFFFF 0%, #DBEAFE 100%); border-bottom: 2px solid var(--primary-200);">
      <h2 class="card-title" style="display: flex; align-items: center; gap: var(--space-3);">
        <svg style="width: 24px; height: 24px; color: var(--primary-600);" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4" />
        </svg>
        Bộ lọc tìm kiếm
      </h2>
    </div>

    <div class="card-body" style="padding: var(--space-6);">
      <form method="get" action="/search" style="display:grid; gap: var(--space-6); grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); align-items: end;">
        <div class="form-group" style="margin: 0;">
          <label class="form-label" style="display: flex; align-items: center; gap: var(--space-2);">
            <svg style="width: 18px; height: 18px; color: var(--primary-600);" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
            </svg>
            Từ khóa tìm kiếm
          </label>
          <input class="form-input" name="q" value="{{ q }}" placeholder="VD: 0001/2025, tên kênh, id video, email..." style="padding: var(--space-4); border: 2px solid var(--border-default); border-radius: var(--radius-lg);" onfocus="this.style.borderColor='var(--primary-600)'; this.style.background='var(--primary-50)';" onblur="this.style.borderColor='var(--border-default)'; this.style.background='white';" />
        </div>

        <div class="form-group" style="margin: 0;">
          <label class="form-label" style="display: flex; align-items: center; gap: var(--space-2);">
            <svg style="width: 18px; height: 18px; color: var(--info-600);" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 10h16M4 14h16M4 18h16" />
            </svg>
            Phạm vi tìm kiếm
          </label>
          <select class="form-input" name="scope" style="padding: var(--space-4); border: 2px solid var(--border-default); border-radius: var(--radius-lg);">
            <option value="all" {% if scope == 'all' %}selected{% endif %}>Tất cả</option>
            <option value="contracts" {% if scope == 'contracts' %}selected{% endif %}>Hợp đồng</option>
            <option value="annexes" {% if scope == 'annexes' %}selected{% endif %}>Phụ lục</option>
            <option value="works" {% if scope == 'works' %}selected{% endif %}>Tác phẩm</option>
            {% if is_admin_mod %}
              <option value="users" {% if scope == 'users' %}selected{% endif %}>Users</option>
            {% endif %}
          </select>
        </div>

        <div class="form-group" style="margin: 0;">
          <label class="form-label" style="display: flex; align-items: center; gap: var(--space-2);">
            <svg style="width: 18px; height: 18px; color: var(--secondary-600);" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
            </svg>
            Năm (tùy chọn)
          </label>
          <input class="form-input" name="year" value="{{ year }}" placeholder="2025" style="padding: var(--space-4); border: 2px solid var(--border-default); border-radius: var(--radius-lg);" onfocus="this.style.borderColor='var(--secondary-600)'; this.style.background='var(--secondary-50)';" onblur="this.style.borderColor='var(--border-default)'; this.style.background='white';" />
        </div>

        <div class="form-group" style="margin: 0;">
          <button class="btn btn-primary" type="submit" style="width: 100%; padding: var(--space-4); font-size: var(--text-base); display: flex; align-items: center; justify-content: center; gap: var(--space-2);">
            <svg style="width: 20px; height: 20px;" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
            </svg>
            Tìm kiếm
          </button>
        </div>
      </form>
    </div>
  </div>

  {% if rows %}
  <div class="card card-enhanced" style="margin-top: var(--space-6);">
    <div class="card-header" style="background: linear-gradient(135deg, #FFFFFF 0%, #D1FAE5 100%); border-bottom: 2px solid var(--success-200);">
      <div style="display: flex; align-items: center; justify-content: space-between;">
        <h2 class="card-title" style="display: flex; align-items: center; gap: var(--space-3);">
          <svg style="width: 24px; height: 24px; color: var(--success-600);" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
          </svg>
          Kết quả tìm kiếm
        </h2>
        <span class="badge badge-green" style="font-size: var(--text-sm); padding: var(--space-3) var(--space-5);">
          <svg style="width: 16px; height: 16px;" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2" />
          </svg>
          {{ rows|length }} kết quả
        </span>
      </div>
    </div>

    <div class="card-body" style="padding: 0;">
      <div style="overflow-x:auto;">
        <table style="width: 100%; border-collapse: collapse;">
          <thead>
            <tr style="background: linear-gradient(135deg, var(--success-50) 0%, var(--primary-50) 100%); border-bottom: 2px solid var(--success-200);">
              <th style="text-align: left; padding: var(--space-4); font-weight: var(--font-semibold); color: var(--success-900); min-width: 120px;">
                <div style="display: flex; align-items: center; gap: var(--space-2);">
                  <svg style="width: 16px; height: 16px;" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z" />
                  </svg>
                  Loại
                </div>
              </th>
              <th style="text-align: center; padding: var(--space-4); font-weight: var(--font-semibold); color: var(--success-900); width: 100px;">Năm</th>
              <th style="text-align: left; padding: var(--space-4); font-weight: var(--font-semibold); color: var(--success-900); min-width: 150px;">Hợp đồng</th>
              <th style="text-align: left; padding: var(--space-4); font-weight: var(--font-semibold); color: var(--success-900); min-width: 120px;">Phụ lục</th>
              <th style="text-align: left; padding: var(--space-4); font-weight: var(--font-semibold); color: var(--success-900); min-width: 250px;">Thông tin</th>
              <th style="text-align: left; padding: var(--space-4); font-weight: var(--font-semibold); color: var(--success-900); min-width: 180px;">Người thực hiện</th>
              <th style="text-align: center; padding: var(--space-4); font-weight: var(--font-semibold); color: var(--success-900); width: 100px;">Hành động</th>
            </tr>
          </thead>
          <tbody>
            {% for r in rows %}
            <tr style="border-bottom: 1px solid var(--border-light); transition: all var(--transition-base);" onmouseover="this.style.background='var(--success-50)';" onmouseout="this.style.background='white';">
              <td style="padding: var(--space-4);">
                {% if r.kind == 'contract' %}
                <span class="badge badge-blue">
                  <svg style="width: 14px; height: 14px;" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                  </svg>
                  Hợp đồng
                </span>
                {% elif r.kind == 'annex' %}
                <span class="badge badge-green">
                  <svg style="width: 14px; height: 14px;" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6" />
                  </svg>
                  Phụ lục
                </span>
                {% elif r.kind == 'work' %}
                <span class="badge badge-orange">
                  <svg style="width: 14px; height: 14px;" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z" />
                  </svg>
                  Tác phẩm
                </span>
                {% elif r.kind == 'user' %}
                <span class="badge" style="background: var(--purple-100); color: var(--purple-700); border-color: var(--purple-300);">
                  <svg style="width: 14px; height: 14px;" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
                  </svg>
                  User
                </span>
                {% else %}
                <span class="badge">{{ r.kind }}</span>
                {% endif %}
              </td>
              <td style="padding: var(--space-4); text-align: center; color: var(--text-secondary); font-weight: var(--font-medium);">{{ r.year or '-' }}</td>
              <td style="padding: var(--space-4); font-family: var(--font-mono); font-size: var(--text-sm); color: var(--primary-700); font-weight: var(--font-semibold);">{{ r.contract_no or '-' }}</td>
              <td style="padding: var(--space-4); font-family: var(--font-mono); font-size: var(--text-sm); color: var(--secondary-700); font-weight: var(--font-semibold);">{{ r.annex_no or '-' }}</td>
              <td style="padding: var(--space-4);">
                {% if r.kind == 'work' %}
                  <div style="font-weight: var(--font-semibold); color: var(--text-primary); margin-bottom: var(--space-1);">{{ r.title }}</div>
                  {% if r.id_work %}
                  <div style="font-size: var(--text-xs); color: var(--text-secondary); font-family: var(--font-mono);">ID: {{ r.id_work }}</div>
                  {% endif %}
                {% elif r.kind == 'user' %}
                  <div style="font-weight: var(--font-semibold); color: var(--text-primary);">{{ r.username }}</div>
                  <span class="badge badge-sm">{{ r.role }}</span>
                {% else %}
                  <div style="font-weight: var(--font-semibold); color: var(--text-primary); margin-bottom: var(--space-1);">{{ r.kenh_ten or '-' }}</div>
                  {% if r.don_vi_ten %}
                  <div style="font-size: var(--text-sm); color: var(--text-secondary);">{{ r.don_vi_ten }}</div>
                  {% endif %}
                {% endif %}
              </td>
              <td style="padding: var(--space-4); color: var(--text-secondary); font-size: var(--text-sm);">{{ r.nguoi_thuc_hien or '-' }}</td>
              <td style="padding: var(--space-4); text-align: center;">
                {% if r.url %}
                  <a class="btn btn-sm" href="{{ r.url }}" style="padding: var(--space-2) var(--space-4); font-size: var(--text-xs); display: inline-flex; align-items: center; gap: var(--space-2); text-decoration: none;">
                    <svg style="width: 14px; height: 14px;" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />
                    </svg>
                    Xem
                  </a>
                {% else %}
                  <span style="color: var(--text-tertiary); font-size: var(--text-xs);">-</span>
                {% endif %}
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </div>
  {% else %}
  <div class="card card-enhanced" style="margin-top: var(--space-6);">
    <div class="card-body" style="text-align: center; padding: var(--space-12);">
      <svg style="width: 80px; height: 80px; color: var(--neutral-400); margin: 0 auto var(--space-6);" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
      </svg>
      <h3 style="font-size: var(--text-2xl); font-weight: var(--font-bold); color: var(--text-primary); margin-bottom: var(--space-3);">Chưa có kết quả tìm kiếm</h3>
      <p style="font-size: var(--text-base); color: var(--text-secondary); margin-bottom: var(--space-6);">Nhập từ khóa và chọn phạm vi để bắt đầu tìm kiếm</p>
      <div style="background: linear-gradient(135deg, var(--info-50) 0%, var(--primary-50) 100%); padding: var(--space-4); border-radius: var(--radius-lg); border: 2px dashed var(--info-300); max-width: 600px; margin: 0 auto; text-align: left;">
        <h4 style="font-size: var(--text-sm); font-weight: var(--font-semibold); color: var(--info-800); margin-bottom: var(--space-3);">Gợi ý tìm kiếm:</h4>
        <ul style="list-style: none; padding: 0; margin: 0;">
          <li style="padding: var(--space-1) 0; font-size: var(--text-sm); color: var(--text-primary);">• Số hợp đồng hoặc phụ lục (VD: 0001/2025)</li>
          <li style="padding: var(--space-1) 0; font-size: var(--text-sm); color: var(--text-primary);">• Tên kênh hoặc tên đơn vị</li>
          <li style="padding: var(--space-1) 0; font-size: var(--text-sm); color: var(--text-primary);">• ID video hoặc tác phẩm</li>
          <li style="padding: var(--space-1) 0; font-size: var(--text-sm); color: var(--text-primary);">• Email người thực hiện</li>
        </ul>
      </div>
    </div>
  </div>
  {% endif %}
</div>
{% endblock %}
