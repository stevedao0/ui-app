{% extends "base.html" %}
{% block content %}
<div style="max-width: 900px; margin: 0 auto;">
  <div class="card" style="margin-bottom: var(--space-8); overflow: visible;">
    <div class="card-header" style="background: linear-gradient(135deg, rgba(20, 184, 166, 0.05) 0%, rgba(255, 255, 255, 1) 100%); border-bottom: 2px solid var(--teal-200); padding: var(--space-8);">
      <div style="display: flex; align-items: center; gap: var(--space-4); margin-bottom: var(--space-3);">
        <div class="icon-container icon-container-teal" style="width: 56px; height: 56px;">
          <svg style="width: 28px; height: 28px; color: white;" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12" />
          </svg>
        </div>
        <div>
          <h1 class="card-title" style="margin: 0; font-size: var(--text-3xl); color: var(--teal-800);">
            Import danh sách tác phẩm
          </h1>
          <p style="font-size: var(--text-sm); color: var(--text-secondary); margin: var(--space-1) 0 0 0;">
            Upload file Excel theo mẫu để import danh mục vào hệ thống
          </p>
        </div>
      </div>
    </div>

    <div class="card-body" style="padding: var(--space-8);">
      {% if error %}
        <div class="alert alert-error" style="margin-bottom: var(--space-6);">
          <svg class="alert-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
          </svg>
          <div class="alert-content">
            <div class="alert-message">{{ error }}</div>
          </div>
        </div>
      {% endif %}

      {% if message %}
        <div class="alert alert-success" style="margin-bottom: var(--space-6);">
          <svg class="alert-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
          </svg>
          <div class="alert-content">
            <div class="alert-message">{{ message }}</div>
          </div>
        </div>
      {% endif %}

      {% if has_permission(request, 'works.read') %}
      <div class="form-section-warning" style="margin-bottom: var(--space-6);">
        <div style="display: flex; align-items: center; gap: var(--space-2); margin-bottom: var(--space-4);">
          <svg style="width: 20px; height: 20px; color: var(--warning-600);" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
          </svg>
          <h3 style="margin: 0; font-size: var(--text-lg); font-weight: var(--font-semibold); color: var(--warning-800);">Tải danh sách hiện có</h3>
        </div>

        <div style="display: flex; gap: var(--space-3); align-items: flex-end; flex-wrap: wrap;">
          <div class="form-group" style="margin: 0; flex: 1; min-width: 200px;">
            <label class="form-label">Chọn năm</label>
            <input class="form-input" type="number" id="worksYear" value="{{ year or '' }}" placeholder="2025" />
          </div>
          <a class="btn btn-warning" href="#" onclick="this.href='/storage/excel/works/download/' + (document.getElementById('worksYear').value || new Date().getFullYear()); return true;" style="display: inline-flex; align-items: center; gap: var(--space-2); white-space: nowrap;">
            <svg style="width: 20px; height: 20px;" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" />
            </svg>
            Tải tổng danh sách
          </a>
        </div>
      </div>
      {% endif %}

      <form method="post" action="/works/import" enctype="multipart/form-data" data-loading>
        <div class="form-section-teal" style="margin-bottom: var(--space-6);">
          <div style="display: flex; align-items: center; gap: var(--space-2); margin-bottom: var(--space-4);">
            <svg style="width: 20px; height: 20px; color: var(--teal-600);" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
            </svg>
            <h3 style="margin: 0; font-size: var(--text-lg); font-weight: var(--font-semibold); color: var(--teal-800);">File import</h3>
          </div>

          <div class="form-group" style="margin: 0;">
            <label class="form-label">
              Chọn file Excel
              <span style="color: var(--error-600);">*</span>
            </label>
            <div style="position: relative; border: 2px dashed var(--teal-300); border-radius: var(--radius-lg); padding: var(--space-8); background: linear-gradient(135deg, var(--teal-50) 0%, white 100%); text-align: center; transition: all var(--transition-base);" onmouseover="this.style.borderColor='var(--teal-500)'; this.style.background='linear-gradient(135deg, var(--teal-100) 0%, white 100%)'" onmouseout="this.style.borderColor='var(--teal-300)'; this.style.background='linear-gradient(135deg, var(--teal-50) 0%, white 100%)'">
              <svg style="width: 48px; height: 48px; color: var(--teal-400); margin: 0 auto var(--space-3);" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-3-3v6m5 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
              </svg>
              <p style="font-size: var(--text-base); color: var(--text-primary); font-weight: var(--font-medium); margin: 0 0 var(--space-1);">
                Chọn file Excel (.xlsx)
              </p>
              <p style="font-size: var(--text-sm); color: var(--text-tertiary); margin: 0;">
                Kéo thả file vào đây hoặc click để chọn
              </p>
              <input class="form-input" type="file" name="import_file" accept=".xlsx" required style="position: absolute; inset: 0; opacity: 0; cursor: pointer;" />
            </div>

            {% if has_permission(request, 'catalogue.upload') %}
            <div style="margin-top: var(--space-4); padding: var(--space-4); background: var(--teal-50); border-radius: var(--radius-md); border-left: 3px solid var(--teal-400);">
              <p style="font-size: var(--text-sm); color: var(--text-secondary); margin: 0 0 var(--space-2); font-weight: var(--font-medium);">
                File cần theo đúng mẫu:
              </p>
              <div style="display: flex; gap: var(--space-2); flex-wrap: wrap;">
                <a href="/templates/import/contract/xlsx" class="btn btn-secondary" style="display: inline-flex; align-items: center; gap: var(--space-2); font-size: var(--text-sm); padding: var(--space-2) var(--space-3);">
                  <svg style="width: 16px; height: 16px;" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" />
                  </svg>
                  Tải mẫu HĐ
                </a>
                <a href="/templates/import/annex/xlsx" class="btn btn-secondary" style="display: inline-flex; align-items: center; gap: var(--space-2); font-size: var(--text-sm); padding: var(--space-2) var(--space-3);">
                  <svg style="width: 16px; height: 16px;" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" />
                  </svg>
                  Tải mẫu PL
                </a>
              </div>
            </div>
            {% endif %}
          </div>
        </div>

        <div style="display: flex; gap: var(--space-3); flex-wrap: wrap; padding-top: var(--space-4); border-top: 1px solid var(--border);">
          {% if has_permission(request, 'works.import') %}
          <button class="btn btn-primary" type="submit" style="display: inline-flex; align-items: center; gap: var(--space-2); padding: var(--space-3) var(--space-6);">
            <svg style="width: 20px; height: 20px;" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12" />
            </svg>
            Import danh sách
          </button>
          {% endif %}
          <a class="btn btn-secondary" href="/contracts" style="display: inline-flex; align-items: center; gap: var(--space-2);">
            <svg style="width: 20px; height: 20px;" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18" />
            </svg>
            Quay lại
          </a>
        </div>
      </form>
    </div>
  </div>
</div>
{% endblock %}
